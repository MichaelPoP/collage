Collage=function(){var e=function(e,t){function n(e,t,n){this.element=e,this.width=t||e.width||parseInt(e.clientWidth),this.height=n||e.height||parseInt(e.clientHeight),this.locations=[]}return e.exports=t,e.exports=n,n.prototype.chanceMultiplier=1,n.prototype.isIn=function(e,t,n,r){var i=this.locations.length,s;while(s=this.locations[--i])if((e<s.left&&s.left<n||s.right<n&&e<s.right)&&(t<s.top&&s.top<r||s.bottom<r&&t<s.bottom))return!0;return!1},n.prototype.reposition=function(e,t){this.element.style.left=e+"px",this.element.style.top=t+"px"},n.prototype.hide=function(){},n.prototype.show=function(e,t){this.reposition(e,t)},e.exports}({},{}),n=function(t,n){function i(e){r.call(this,e,parseInt(e.width),parseInt(e.height))}t.exports=n;var r=e;t.exports=i,i.prototype=Object.create(r.prototype);var s=document.createDocumentFragment();return i.prototype.hide=function(){r.prototype.hide.call(this),s.appendChild(this.element)},i.prototype.show=function(e,t,n){r.prototype.show.call(this,e,t),n.appendChild(this.element)},t.exports}({},{}),r=function(t,n){function i(e){var t=e.element;r.call(this,t),this.video=e,this.hide()}t.exports=n;var r=e;return t.exports=i,i.prototype=Object.create(r.prototype),i.prototype.hide=function(){r.prototype.hide.call(this),this.element.style.visibility="hidden",this.video.continuousPlay||this.video.player.pauseVideo()},i.prototype.show=function(e,t){this.element.style.visibility="",r.prototype.show.call(this,e,t);var n=this;setTimeout(function(){n.video.player.playVideo()})},t.exports}({},{}),i=function(e,t){return e.exports=t,function(n,r){typeof t=="object"&&t?e.exports=r:typeof define=="function"&&define.amd?define(r):n.Mustache=r}(this,function(){function u(e,t){return RegExp.prototype.test.call(e,t)}function a(e){return!u(r,e)}function l(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function h(e){return String(e).replace(/[&<>"'\/]/g,function(e){return c[e]})}function p(e){this.string=e,this.tail=e,this.pos=0}function d(e,t){this.view=e,this.parent=t,this.clearCache()}function v(){this.clearCache()}function m(e){function n(e,n,r){if(!t[e]){var i=m(n);t[e]=function(e,t){return i(e,t,r)}}return t[e]}var t={};return function(t,r,i){var s="",o,u;for(var a=0,f=e.length;a<f;++a){o=e[a];switch(o[0]){case"#":u=i.slice(o[3],o[5]),s+=t._section(o[1],r,u,n(a,o[4],i));break;case"^":s+=t._inverted(o[1],r,n(a,o[4],i));break;case">":s+=t._partial(o[1],r);break;case"&":s+=t._name(o[1],r);break;case"name":s+=t._escaped(o[1],r);break;case"text":s+=o[1]}}return s}}function g(e){var t=[],n=t,r=[],i;for(var s=0,o=e.length;s<o;++s){i=e[s];switch(i[0]){case"#":case"^":r.push(i),n.push(i),n=i[4]=[];break;case"/":var u=r.pop();u[5]=i[2],n=r.length>0?r[r.length-1][4]:t;break;default:n.push(i)}}return t}function y(e){var t=[],n,r;for(var i=0,s=e.length;i<s;++i)n=e[i],n[0]==="text"&&r&&r[0]==="text"?(r[1]+=n[1],r[3]=n[3]):(r=n,t.push(n));return t}function b(e){return[new RegExp(l(e[0])+"\\s*"),new RegExp("\\s*"+l(e[1]))]}var e={};e.name="mustache.js",e.version="0.7.2",e.tags=["{{","}}"],e.Scanner=p,e.Context=d,e.Writer=v;var t=/\s*/,n=/\s+/,r=/\S/,i=/\s*=/,s=/\s*\}/,o=/#|\^|\/|>|\{|&|=|!/,f=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};e.escape=h,p.prototype.eos=function(){return this.tail===""},p.prototype.scan=function(e){var t=this.tail.match(e);return t&&t.index===0?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},p.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return t},d.make=function(e){return e instanceof d?e:new d(e)},d.prototype.clearCache=function(){this._cache={}},d.prototype.push=function(e){return new d(e,this)},d.prototype.lookup=function(e){var t=this._cache[e];if(!t){if(e===".")t=this.view;else{var n=this;while(n){if(e.indexOf(".")>0){var r=e.split("."),i=0;t=n.view;while(t&&i<r.length)t=t[r[i++]]}else t=n.view[e];if(t!=null)break;n=n.parent}}this._cache[e]=t}return typeof t=="function"&&(t=t.call(this.view)),t},v.prototype.clearCache=function(){this._cache={},this._partialCache={}},v.prototype.compile=function(t,n){var r=this._cache[t];if(!r){var i=e.parse(t,n);r=this._cache[t]=this.compileTokens(i,t)}return r},v.prototype.compilePartial=function(e,t,n){var r=this.compile(t,n);return this._partialCache[e]=r,r},v.prototype.compileTokens=function(e,t){var n=m(e),r=this;return function(e,i){if(i)if(typeof i=="function")r._loadPartial=i;else for(var s in i)r.compilePartial(s,i[s]);return n(r,d.make(e),t)}},v.prototype.render=function(e,t,n){return this.compile(e)(t,n)},v.prototype._section=function(e,t,n,r){var i=t.lookup(e);switch(typeof i){case"object":if(f(i)){var s="";for(var o=0,u=i.length;o<u;++o)s+=r(this,t.push(i[o]));return s}return i?r(this,t.push(i)):"";case"function":var a=this,l=function(e){return a.render(e,t)},c=i.call(t.view,n,l);return c!=null?c:"";default:if(i)return r(this,t)}return""},v.prototype._inverted=function(e,t,n){var r=t.lookup(e);return!r||f(r)&&r.length===0?n(this,t):""},v.prototype._partial=function(e,t){!(e in this._partialCache)&&this._loadPartial&&this.compilePartial(e,this._loadPartial(e));var n=this._partialCache[e];return n?n(t):""},v.prototype._name=function(e,t){var n=t.lookup(e);return typeof n=="function"&&(n=n.call(t.view)),n==null?"":String(n)},v.prototype._escaped=function(t,n){return e.escape(this._name(t,n))},e.parse=function(r,u){function E(){if(m&&!w)while(v.length)d.splice(v.pop(),1);else v=[];m=!1,w=!1}r=r||"",u=u||e.tags,typeof u=="string"&&(u=u.split(n));if(u.length!==2)throw new Error("Invalid tags: "+u.join(", "));var f=b(u),c=new p(r),h=[],d=[],v=[],m=!1,w=!1,S,x,T,N;while(!c.eos()){S=c.pos,T=c.scanUntil(f[0]);if(T)for(var C=0,k=T.length;C<k;++C)N=T.charAt(C),a(N)?v.push(d.length):w=!0,d.push(["text",N,S,S+1]),S+=1,N==="\n"&&E();S=c.pos;if(!c.scan(f[0]))break;m=!0,x=c.scan(o)||"name",c.scan(t);if(x==="=")T=c.scanUntil(i),c.scan(i),c.scanUntil(f[1]);else if(x==="{"){var L=new RegExp("\\s*"+l("}"+u[1]));T=c.scanUntil(L),c.scan(s),c.scanUntil(f[1]),x="&"}else T=c.scanUntil(f[1]);if(!c.scan(f[1]))throw new Error("Unclosed tag at "+c.pos);if(x==="/"){if(h.length===0)throw new Error('Unopened section "'+T+'" at '+S);var A=h.pop();if(A[1]!==T)throw new Error('Unclosed section "'+A[1]+'" at '+S)}var O=[x,T,S,c.pos];d.push(O);if(x==="#"||x==="^")h.push(O);else if(x==="name"||x==="{"||x==="&")w=!0;else if(x==="="){u=T.split(n);if(u.length!==2)throw new Error("Invalid tags at "+S+": "+u.join(", "));f=b(u)}}var A=h.pop();if(A)throw new Error('Unclosed section "'+A[1]+'" at '+c.pos);return g(y(d))};var w=new v;return e.clearCache=function(){return w.clearCache()},e.compile=function(e,t){return w.compile(e,t)},e.compilePartial=function(e,t,n){return w.compilePartial(e,t,n)},e.compileTokens=function(e,t){return w.compileTokens(e,t)},e.render=function(e,t,n){return w.render(e,t,n)},e.to_html=function(t,n,r,i){var s=e.render(t,n,r);if(typeof i!="function")return s;i(s)},e}()),e.exports}({},{}),s=function(e,t){return e.exports=t,function(e){"use strict";function t(){}function i(e,t){if(r)return t.indexOf(e);var n=t.length;while(n--)if(t[n]===e)return n;return-1}var n=t.prototype,r=Array.prototype.indexOf?!0:!1;n._getEvents=function(){return this._events||(this._events={})},n.getListeners=function(e){var t=this._getEvents();return t[e]||(t[e]=[])},n.addListener=function(e,t){var n=this.getListeners(e);return i(t,n)===-1&&n.push(t),this},n.on=n.addListener,n.removeListener=function(e,t){var n=this.getListeners(e),r=i(t,n);return r!==-1&&(n.splice(r,1),n.length===0&&this.removeEvent(e)),this},n.off=n.removeListener,n.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},n.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},n.manipulateListeners=function(e,t,n){var r,i,s=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if(typeof t=="object")for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&(typeof i=="function"?s.call(this,r,i):o.call(this,r,i));else{r=n.length;while(r--)s.call(this,t,n[r])}return this},n.removeEvent=function(e){return e?delete this._getEvents()[e]:delete this._events,this},n.emitEvent=function(e,t){var n=this.getListeners(e),r=n.length,i;while(r--)i=t?n[r].apply(null,t):n[r](),i===!0&&this.removeListener(e,n[r]);return this},n.trigger=n.emitEvent,n.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},typeof define=="function"&&define.amd?define(function(){return t}):e.EventEmitter=t}(this),e.exports}({},{}),o=function(e,n){return e.exports=n,e.exports=function(){var e=function(e,n){return e.exports=n,e.exports=function(){var e=function(e,n){e.exports=n,n.linear=function(e,t,n,r){return n*e/r+t},n.quadraticIn=function(e,t,n,r){return n*(e/=r)*e+t},n.quadraticOut=function(e,t,n,r){return-n*(e/=r)*(e-2)+t},n.quadraticInOut=function(e,t,n,r){return e/=r/2,e<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},n.cubicIn=function(e,t,n,r){return n*(e/=r)*e*e+t},n.cubicOut=function(e,t,n,r){return e/=r,n*(--e*e*e+1)+t},n.cubicInOut=function(e,t,n,r){return e/=r/2,e<1?n*(e/=r)*e*e+t:n/2*((e-=2)*e*e+2)+t};var r=Math.PI/2;return n.sinusoidalIn=function(e,t,n,i){return-n*Math.cos(e/i*r)+n+t},n.sinusoidalOut=function(e,t,n,i){return n*Math.sin(e/i*r)+t},n.sinusoidalInOut=function(e,t,n,r){return-n/2*(Math.cos(Math.PI*e/r)-1)+t},n.exponentialIn=function(e,t,n,r){return n*Math.pow(2,10*(e/r-1))+t},n.exponentialOut=function(e,t,n,r){return n*(-Math.pow(2,-10*e/r)+1)+t},n.exponentialInOut=function(e,n,r,i){return e/=i/2,e<1?r/2*Math.pow(2,10*(e-1))+n:r/2*(-Math.pow(2,-10*--t)+2)+n},e.exports}({},{}),n=function(t,n){t.exports=n;var r=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,15)},i=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||function(e){return clearTimeout(e)},s=t.exports=function(e,t,n,s,o,u){function d(){if(h)return;h=!0,i(p),c=Date.now()}function v(){if(!h)return;h=!1,l+=Date.now()-c,p=r(m)}function m(){var i=Date.now()-l;i<o?(t[n]=e(i,a,f,o),p=r(m)):(t[n]=e(o,a,f,o),u&&u())}o=o||0;var a=t[n],f=s-a,l=Date.now(),c=l,h=!0,p;return v(),{resume:v,pause:d}},o=e,u;for(u in o)o.hasOwnProperty(u)&&(s[u]=s.bind(void 0,o[u]));return s.easing=o,t.exports}({},{});return n}(),e.exports}({},{}),n=function(e,t){e.exports=t;var n=t.noop=function(){};t.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,15)},t.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||function(e){return clearTimeout(e)},t.requestFullscreen=document.documentElement.requestFullscreen||document.documentElement.mozRequestFullScreen||document.documentElement.webkitRequestFullscreen||n;var r=document.body.style;return t.transformAttribute=r.msTransform!==void 0&&"msTransform"||r.webkitTransform!==void 0&&"webkitTransform"||r.MozTransform!==void 0&&"MozTransform"||r.transform!==void 0&&"transform",t.transitionAttribute=r.msTransition!==void 0&&"msTransition"||r.webkitTransition!==void 0&&"webkitTransition"||r.MozTransition!==void 0&&"MozTransition"||r.transition!==void 0&&"transition",t.filterAttribute=r.msFilter!==void 0&&"msFilter"||r.webkitFilter!==void 0&&"webkitFilter"||r.MozFilter!==void 0&&"MozFilter"||r.filter!==void 0&&"filter",e.exports}({},{}),r=function(t,r){t.exports=r;var i=n,s=i.requestAnimationFrame,o=i.cancelAnimationFrame,u=e,a=t.exports=function(e){this.container=e,this.element=document.createElement("div"),this.element.style.position="absolute",e.appendChild(this.element),this.refit(),this.offsetX=0,this.offsetY=0,this.speedMultiplierX=0,this.speedMultiplierY=0,this.multiStyle={},this.multiStyle[i.transformAttribute]={},this.multiStyle[i.transitionAttribute]={},this.multiStyle[i.filterAttribute]={},this.pointerEventHandler=this.pointerEventHandler.bind(this),this.step=this.step.bind(this)};return a.create=function(e){var t=new a(e);return a.getApi(t)},a.getApi=function(e){var t={};return t.start=e.start.bind(e),t.pause=e.pause.bind(e),t.refit=e.refit.bind(e),t.element=e.element,t.blur=e.setBlur.bind(e),t.grayscale=e.setGrayscale.bind(e),t.opacity=e.setOpacity.bind(e),t.speed=e.setSpeedLimit.bind(e),t.horizontalSpeed=e.setHorizontalSpeedLimit.bind(e),t.verticalSpeed=e.setVerticalSpeedLimit.bind(e),t.horizontalWind=e.setHorizontalWind.bind(e),t.verticalWind=e.setVerticalWind.bind(e),t},a.prototype.horizontalSpeedLimit=4,a.prototype.verticalSpeedLimit=4,a.prototype.horizontalWind=0,a.prototype.verticalWind=0,a.prototype.msPerStep=16,a.prototype.horizontalSpeedGradient=u.easing.quadraticIn,a.prototype.verticalSpeedGradient=u.easing.quadraticIn,a.prototype.pointerTrackingEvents=["mousemove","touchstart","touchend","touchmove"],a.prototype.start=function(){if(this.active)return;this.active=!0,this.attachPointerListeners(),this.lastStepTime=Date.now(),this.animationRequestId=s(this.step)},a.prototype.pause=function(){if(!this.active)return;this.active=!1,o(this.animationRequestId),this.detachPointerListeners()},a.prototype.step=function(){this.refit();var e=Date.now(),t=(e-this.lastStepTime)/this.msPerStep;this.lastStepTime=e,this.offsetX+=t*(this.horizontalWind+this.speedMultiplierX*this.horizontalSpeedLimit),this.offsetY+=t*(this.verticalWind+this.speedMultiplierY*this.verticalSpeedLimit),this.setCssTransform("translate",this.offsetX+"px, "+this.offsetY+"px"),this.animationRequestId=s(this.step)},a.prototype.attachPointerListeners=function(){var e=this;this.pointerTrackingEvents.forEach(function(t){e.container.addEventListener(t,e.pointerEventHandler)}),this.container.addEventListener("mousemove",e.pointerEventHandler)},a.prototype.detachPointerListeners=function(){var e=this;this.pointerTrackingEvents.forEach(function(t){e.container.removeEventListener(t,e.pointerEventHandler)})},a.prototype.pointerEventHandler=function(e){var t=e.changedTouches&&e.changedTouches[0]||e,n=t.clientX-this.left;y=t.clientY-this.top,this.speedMultiplierX=this.horizontalSpeedGradient(n-this.halfWidth,0,n>this.halfWidth?-1:1,this.halfWidth),this.speedMultiplierY=this.verticalSpeedGradient(y-this.halfHeight,0,y>this.halfHeight?-1:1,this.halfHeight)},a.prototype.refit=function(){var e=this.container.getBoundingClientRect();this.width=e.width,this.halfWidth=this.width/2,this.height=e.height,this.halfHeight=this.height/2,this.top=e.top,this.left=e.left},a.prototype.setHorizontalWind=function(e,t,n){if(!t)return this.horizontalWind=e;n=n||this.horizontalWind<e?u.easing.quadraticIn:u.easing.quadraticOut,u(n,this,"horizontalWind",e,t)},a.prototype.setVerticalWind=function(e,t,n){if(!t)return this.verticalWind=e;n=n||this.verticalWind<e?u.easing.quadraticIn:u.easing.quadraticOut,u(n,this,"verticalWind",e,t)},a.prototype.setSpeedLimit=function(e,t,n,r){if(!t){this.horizontalSpeedLimit=e,this.verticalSpeedLimit=e;return}this.setHorizontalSpeedLimit(e,t,n,r),this.setVerticalSpeedLimit(e,t,n)},a.prototype.setHorizontalSpeedLimit=function(e,t,n,r){if(!t)return this.horizontalSpeedLimit=e;n=n||this.horizontalSpeedLimit<e?u.easing.quadraticIn:u.easing.quadraticOut,u(n,this,"horizontalSpeedLimit",e,t,r)},a.prototype.setVerticalSpeedLimit=function(e,t,n,r){if(!t)return this.verticalSpeedLimit=e;n=n||this.verticalSpeedLimit<e?u.easing.quadraticIn:u.easing.quadraticOut,u(n,this,"verticalSpeedLimit",e,t,r)},a.prototype.setBlur=function(e,t){t!==void 0&&this.setCssTransition("-webkit-filter",t+"s"),this.setCssFilter("blur",e+"px")},a.prototype.setGrayscale=function(e,t){t!==void 0&&this.setCssTransition("-webkit-filter",t+"s"),this.setCssFilter("grayscale",e)},a.prototype.setOpacity=function(e,t){t!==void 0&&this.setCssTransition("opacity",t+"s"),this.element.style.opacity=e},a.prototype.setCssTransform=function(e,t){this.cssTransforms[e]=t,this.updateMultiAttributeStyle(i.transformAttribute,this.cssTransforms)},a.prototype.setCssFilter=function(e,t){this.cssFilters[e]=t,this.updateMultiAttributeStyle(i.filterAttribute,this.cssFilters)},a.prototype.setCssTransition=function(e,t){this.cssTransitions[e]=t,this.updateMultiAttributeStyle(i.transitionAttribute,this.cssTransitions,!0)},a.prototype.cssTransitions={"-webkit-filter":"0s",opacity:"0s"},a.prototype.cssFilters={blur:"0px",grayscale:"0"},a.prototype.cssTransforms={translate:"0px, 0px"},a.prototype.updateMultiAttributeStyle=function(e,t,n){var r,i=[];for(r in t)t.hasOwnProperty(r)&&i.push(r+(n?" ":"(")+t[r]+(n?"":")"));this.element.style[e]=i.join(n?", ":" ")},t.exports}({},{});return r}(),e.exports}({},{}),u=function(e,t){return e.exports=t,e.exports=function(){var e=function(e,t){function n(e,t,n,r,i){this.objects=[],this.left=e,this.top=t,this.width=n,this.height=r,this.parent=i}return e.exports=t,e.exports=n,n.prototype.tl=void 0,n.prototype.tr=void 0,n.prototype.br=void 0,n.prototype.bl=void 0,n.prototype.OBJECT_LIMIT=200,n.prototype.clear=function(){this.objects=[],this.tl&&(this.tl.clear(),this.tr.clear(),this.br.clear(),this.bl.clear())},n.prototype.getObjects=function(){return this.tl?this.objects.concat(this.tl.getObjects(),this.tr.getObjects(),this.br.getObjects(),this.bl.getObjects()):this.objects.slice()},n.prototype.split=function(){var e=this.width/2,t=this.height/2,r=this.left,i=this.top;this.tl=new n(r,i,e,t,this),this.tr=new n(r+e,i,e,t,this),this.br=new n(r+e,i+t,e,t,this),this.bl=new n(r,i+t,e,t,this)},n.prototype.parentNode=function(e){var t=this,n;return e.left<t.left?e.top<t.top?n=t.grow(t.width,t.height):n=t.grow(t.width,0):e.left+e.width>t.left+t.width?e.top<t.top?n=t.grow(0,t.height):n=t.grow(0,0):e.top<t.top?n=t.grow(0,t.height):e.top+e.height>t.top+t.height&&(n=t.grow(0,0)),n?n.parentNode(e):t},n.prototype.getQuadrantAt=function(e,t){if(!this.tl)return this;var n=this.left+this.width/2,r=this.top+this.height/2;return e<n?t<r?this.tl.tl&&this.tl.getQuadrantAt(e,t)||this.tl:this.bl.tl&&this.bl.getQuadrantAt(e,t)||this.bl:t<r?this.tr.tl&&this.tr.getQuadrantAt(e,t)||this.tr:this.br.tl&&this.br.getQuadrantAt(e,t)||this.br},n.prototype.getInteractableObjects=function(e,t,n,r){if(!this.tl)return this.objects.slice();var i=this.getQuadrant(e,t,n,r),s=[i.objects],o=[i],u=i.parent;while(u)s.push(u.objects),o.push(u),u=u.parent;if(i.tl){var a=i.getQuadrantAt(e,t);~o.indexOf(a)||(o.push(a),s.push(a.objects),a.parent&&!~o.indexOf(a.parent)&&(o.push(a.parent),s.push(a.parent.objects))),a=i.getQuadrantAt(e+n,t),~o.indexOf(a)||(o.push(a),s.push(a.objects),a.parent&&!~o.indexOf(a.parent)&&(o.push(a.parent),s.push(a.parent.objects))),a=i.getQuadrantAt(e+n,t+r),~o.indexOf(a)||(o.push(a),s.push(a.objects),a.parent&&!~o.indexOf(a.parent)&&(o.push(a.parent),s.push(a.parent.objects))),a=i.getQuadrantAt(e,t+r),~o.indexOf(a)||(o.push(a),s.push(a.objects),a.parent&&!~o.indexOf(a.parent)&&s.push(a.parent.objects))}return Array.prototype.concat.apply([],s)},n.prototype.getQuadrant=function(e,t,n,r){if(!this.tl)return this;var i=this.left+this.width/2,s=this.top+this.height/2,o=t<s&&t+r<s,u=t>s;if(e<i&&e+n<i){if(o)return this.tl.tl&&this.tl.getQuadrant(e,t,n,r)||this.tl;if(u)return this.bl.tl&&this.bl.getQuadrant(e,t,n,r)||this.bl}else if(e>i){if(o)return this.tr.tl&&this.tr.getQuadrant(e,t,n,r)||this.tr;if(u)return this.br.tl&&this.br.getQuadrant(e,t,n,r)||this.br}return this},n.prototype.insert=function(e){var t,n,r,i,s,o;o=this.parentNode(e),t=o.getQuadrant(e.left,e.top,e.width,e.height);if(t!==o)t.insert(e);else{s=o.objects,s.push(e),n=0,r=s.length;if(r>o.OBJECT_LIMIT){o.tl||o.split(),i=[];for(;n<r;n++)e=o.objects[n],t=o.getQuadrant(e.left,e.top,e.width,e.height),t!==o?t.insert(e):i.push(e);o.objects=i}}return o},n.prototype.grow=function(e,t){var r=this.left-e,i=this.top-t,s=new n(r,i,this.width*2,this.height*2);return this.parent=s,e?t?s.br=this:s.tr=this:t?s.bl=this:s.tl=this,s.tl=s.tl||new n(r,i,this.width,this.height,this),s.tr=s.tr||new n(r+this.width,i,this.width,this.height,this),s.br=s.br||new n(r+this.width,i+this.height,this.width,this.height,this),s.bl=s.bl||new n(r,i+this.height,this.width,this.height,this),s},e.exports}({},{}),t=function(t,n){t.exports=n;var r=e,i=t.exports=function(e,t){e&&(this.width=e,this.height=t?t:e),this.reset()};return i.create=function(e,t){var n=new i(e,t);return i.getApi(n)},i.getApi=function(e){var t={};return t.insert=e.insert.bind(e),t.reset=e.reset.bind(e),t.getObjects=e.getObjects.bind(e),t.hasObject=e.hasObject.bind(e),t.prune=e.prune.bind(e),t},i.prototype.width=1e4,i.prototype.height=1e4,i.prototype.reset=function(e,t){e=e||0,t=t||0;var n=-(this.width/2),i=-(this.height/2);this.top=new r(e+n,t+i,this.width,this.height)},i.prototype.insert=function(e){this.top=this.top.insert(e)},i.prototype.getObjects=function(e,t,n,r){return e?this.top.getInteractableObjects(e,t,n,r):this.top.getObjects()},i.prototype.prune=function(e,t,n,r){var i=e+n,s=t+r,o,u=[];keptObjects=[];var a=this.top.getObjects(),f=0,l=a.length;for(;f<l;f++)o=a[f],o.left<e||o.top<t||o.left+o.width>i||o.top+o.height>s?u.push(o):keptObjects.push(o);if(keptObjects.length){this.reset(keptObjects[0].left,keptObjects[0].top),f=0,l=keptObjects.length;for(;f<l;f++)this.insert(keptObjects[f])}else this.reset();return u},i.prototype.hasObject=function(e,t,n,r){var i=this.top.getInteractableObjects(e,t,n,r),s=i.length,o=0,u;for(;o<s;o++){u=i[o];if((t<u.top?t+r>u.top:u.top+u.height>t)&&(e<u.left?e+n>u.left:u.left+u.width>e))return u}return!1},t.exports}({},{});return t}(),e.exports}({},{}),a=function(e,t){return e.exports=t,function(e){if(typeof bootstrap=="function")bootstrap("promise",e);else if(typeof t=="object")e(void 0,t);else if(typeof define=="function")define(e);else if(typeof ses!="undefined"){if(!ses.ok())return;ses.makeQ=function(){var t={};return e(void 0,t)}}else e(void 0,Q={})}(function(e,t){"use strict";function b(e){return y(e)==="[object StopIteration]"||e instanceof w}function S(e,t){t.stack&&typeof e=="object"&&e!==null&&e.stack&&e.stack.indexOf(E)===-1&&(e.stack=x(e.stack)+"\n"+E+"\n"+x(t.stack))}function x(e){var t=e.split("\n"),n=[];for(var r=0;r<t.length;++r){var i=t[r];!N(i)&&!T(i)&&n.push(i)}return n.join("\n")}function T(e){return e.indexOf("(module.js:")!==-1||e.indexOf("(node.js:")!==-1}function N(e){var t=/at .+ \((.*):(\d+):\d+\)/.exec(e);if(!t)return!1;var i=t[1],s=t[2];return i===r&&s>=n&&s<=Nt}function C(){if(Error.captureStackTrace){var e,t,n=Error.prepareStackTrace;return Error.prepareStackTrace=function(n,r){e=r[1].getFileName(),t=r[1].getLineNumber()},(new Error).stack,Error.prepareStackTrace=n,r=e,t}}function k(e,t,n){return function(){return typeof console!="undefined"&&typeof console.warn=="function"&&console.warn(t+" is deprecated, use "+n+" instead.",(new Error("")).stack),e.apply(e,arguments)}}function L(){function u(r){if(!e)return;n=U(r),p(e,function(e,t){o(function(){n.promiseSend.apply(n,t)})},void 0),e=void 0,t=void 0}var e=[],t=[],n,r=m(L.prototype),i=m(O.prototype);return i.promiseSend=function(r,i,s,u){var a=h(arguments);e?(e.push(a),r==="when"&&u&&t.push(u)):o(function(){n.promiseSend.apply(n,a)})},i.valueOf=function(){return e?i:n.valueOf()},Error.captureStackTrace&&(Error.captureStackTrace(i,L),i.stack=i.stack.substring(i.stack.indexOf("\n")+1)),s(i),r.promise=i,r.resolve=u,r.reject=function(e){u(R(e))},r.notify=function(n){e&&p(t,function(e,t){o(function(){t(n)})},void 0)},r}function A(e){var t=L();return st(e,t.resolve,t.reject,t.notify).fail(t.reject),t.promise}function O(e,t,n,r){t===void 0&&(t=function(e){return R(new Error("Promise does not support operation: "+e))});var i=m(O.prototype);return i.promiseSend=function(n,r){var s=h(arguments,2),o;try{e[n]?o=e[n].apply(i,s):o=t.apply(i,[n].concat(s))}catch(u){o=R(u)}r&&r(o)},n&&(i.valueOf=n),r&&(i.exception=r),s(i),i}function M(e){return _(e)?e.valueOf():e}function _(e){return e&&typeof e.promiseSend=="function"}function D(e){return e&&typeof e.then=="function"}function P(e){return H(e)||B(e)}function H(e){return!D(M(e))}function B(e){return e=M(e),_(e)&&"exception"in e}function q(){!I&&typeof window!="undefined"&&!window.Touch&&window.console&&console.log("Should be empty:",F),I=!0}function R(e){var t=O({when:function(t){if(t){var n=d(j,this);n!==-1&&(F.splice(n,1),j.splice(n,1))}return t?t(e):R(e)}},function(){return R(e)},function n(){return this},e);return q(),j.push(t),F.push(e),t}function U(e){if(_(e))return e;e=M(e);if(D(e)){var t=L();return e.then(t.resolve,t.reject,t.notify),t.promise}return O({when:function(){return e},get:function(t){return e[t]},put:function(t,n){return e[t]=n,e},del:function(t){return delete e[t],e},post:function(t,n){return e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},fapply:function(t){return e.apply(void 0,t)},viewInfo:function(){function r(e){n[e]||(n[e]=typeof t[e])}var t=e,n={};while(t)Object.getOwnPropertyNames(t).forEach(r),t=Object.getPrototypeOf(t);return{type:typeof e,properties:n}},keys:function(){return g(e)}},void 0,function n(){return e})}function z(e){return O({isDef:function(){}},function(){var n=h(arguments);return Y.apply(void 0,[e].concat(n))},function(){return M(e)})}function W(e,t){return e=U(e),t?O({viewInfo:function(){return t}},function(){var n=h(arguments);return Y.apply(void 0,[e].concat(n))},function(){return M(e)}):Y(e,"viewInfo")}function X(e){return W(e).when(function(t){var n;t.type==="function"?n=function(){return nt(e,void 0,arguments)}:n={};var r=t.properties||{};return g(r).forEach(function(t){r[t]==="function"&&(n[t]=function(){return tt(e,t,arguments)})}),U(n)})}function V(e,t,n,r){function u(e){try{return typeof t=="function"?t(e):e}catch(n){return R(n)}}function a(e){if(typeof n=="function"){S(e,l);try{return n(e)}catch(t){return R(t)}}return R(e)}function f(e){return typeof r=="function"?r(e):e}var i=L(),s=!1,l=U(e);return o(function(){l.promiseSend("when",function(e){if(s)return;s=!0,i.resolve(u(e))},function(e){if(s)return;s=!0,i.resolve(a(e))})}),l.promiseSend("when",void 0,void 0,function(e){i.notify(f(e))}),i.promise}function $(e,t,n){return V(e,function(e){return at(e).then(function(e){return t.apply(void 0,e)},n)},n)}function J(e){return function(){function t(e,t){var s;try{s=n[e](t)}catch(o){return b(o)?o.value:R(o)}return V(s,r,i)}var n=e.apply(this,arguments),r=t.bind(t,"send"),i=t.bind(t,"throw");return r()}}function K(e){throw new w(e)}function Q(e){return function(){return at([this,at(arguments)]).spread(function(t,n){return e.apply(t,n)})}}function G(e){return function(t){var n=h(arguments,1);return Y.apply(void 0,[t,e].concat(n))}}function Y(e,t){var n=L(),r=h(arguments,2);return e=U(e),o(function(){e.promiseSend.apply(e,[t,n.resolve].concat(r))}),n.promise}function Z(e,t,n){var r=L();return e=U(e),o(function(){e.promiseSend.apply(e,[t,r.resolve].concat(n))}),r.promise}function et(e){return function(t){var n=h(arguments,1);return Z(t,e,n)}}function it(e,t){var n=h(arguments,2);return nt(e,t,n)}function st(e){var t=h(arguments,1);return rt(e,t)}function ot(e,t){var n=h(arguments,2);return function(){var i=n.concat(h(arguments));return nt(e,t,i)}}function ut(e){var t=h(arguments,1);return function(){var r=t.concat(h(arguments));return rt(e,r)}}function at(e){return V(e,function(e){var t=e.length;if(t===0)return U(e);var n=L();return p(e,function(r,i,s){H(i)?(e[s]=M(i),--t===0&&n.resolve(e)):V(i,function(r){e[s]=r,--t===0&&n.resolve(e)}).fail(n.reject)},void 0),n.promise})}function ft(e){return V(e,function(e){return V(at(v(e,function(e){return V(e,i,i)})),function(){return v(e,U)})})}function lt(e,t){return V(e,void 0,t)}function ct(e,t){return V(e,void 0,void 0,t)}function ht(e,t){return V(e,function(e){return V(t(),function(){return e})},function(e){return V(t(),function(){return R(e)})})}function pt(e,n,r,i){function s(n){o(function(){S(n,e);if(!t.onerror)throw n;t.onerror(n)})}var u=n||r||i?V(e,n,r,i):e;lt(u,s)}function dt(e,t){var n=L(),r=setTimeout(function(){n.reject(new Error("Timed out after "+t+" ms"))},t);return V(e,function(e){clearTimeout(r),n.resolve(e)},function(e){clearTimeout(r),n.reject(e)}),n.promise}function vt(e,t){t===void 0&&(t=e,e=void 0);var n=L();return setTimeout(function(){n.resolve(e)},t),n.promise}function mt(e,t){var n=h(t),r=L();return n.push(r.makeNodeResolver()),rt(e,n).fail(r.reject),r.promise}function gt(e){var t=h(arguments,1),n=L();return t.push(n.makeNodeResolver()),rt(e,t).fail(n.reject),n.promise}function yt(e){var t=h(arguments,1);return function(){var n=t.concat(h(arguments)),r=L();return n.push(r.makeNodeResolver()),rt(e,n).fail(r.reject),r.promise}}function bt(e,t,n){return Et(e,t).apply(void 0,n)}function wt(e,t){var n=h(arguments,2);return bt(e,t,n)}function Et(e){if(arguments.length>1){var t=arguments[1],n=h(arguments,2),r=e;e=function(){var e=n.concat(h(arguments));return r.apply(t,e)}}return function(){var t=L(),n=h(arguments);return n.push(t.makeNodeResolver()),rt(e,n).fail(t.reject),t.promise}}function St(e,t,n){var r=h(n),i=L();return r.push(i.makeNodeResolver()),tt(e,t,r).fail(i.reject),i.promise}function xt(e,t){var n=h(arguments,2),r=L();return n.push(r.makeNodeResolver()),tt(e,t,n).fail(r.reject),r.promise}function Tt(e,t){if(!t)return e;e.then(function(e){o(function(){t(null,e)})},function(e){o(function(){t(e)})})}var n=C(),r,i=function(){},s=Object.freeze||i;typeof cajaVM!="undefined"&&(s=cajaVM.def);var o;if(typeof process!="undefined")o=process.nextTick;else if(typeof setImmediate=="function")o=setImmediate;else if(typeof MessageChannel!="undefined"){var u=new MessageChannel,a={},f=a;u.port1.onmessage=function(){a=a.next;var e=a.task;delete a.task,e()},o=function(e){f=f.next={task:e},u.port2.postMessage(0)}}else o=function(e){setTimeout(e,0)};var l;if(Function.prototype.bind){var c=Function.prototype.bind;l=c.bind(c.call)}else l=function(e){return function(){return e.call.apply(e,arguments)}};var h=l(Array.prototype.slice),p=l(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(arguments.length===1)do{if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}while(1);for(;n<r;n++)n in this&&(t=e(t,this[n],n));return t}),d=l(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),v=l(Array.prototype.map||function(e,t){var n=this,r=[];return p(n,function(i,s,o){r.push(e.call(t,s,o,n))},void 0),r}),m=Object.create||function(e){function t(){}return t.prototype=e,new t},g=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t},y=Object.prototype.toString,w;typeof ReturnValue!="undefined"?w=ReturnValue:w=function(e){this.value=e};var E="From previous event:";t.nextTick=o,t.defer=L,L.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(h(arguments,1)):e.resolve(n)}},L.prototype.node=k(L.prototype.makeNodeResolver,"node","makeNodeResolver"),t.promise=A,t.makePromise=O,O.prototype.then=function(e,t,n){return V(this,e,t,n)},O.prototype.thenResolve=function(e){return V(this,function(){return e})},p(["isResolved","isFulfilled","isRejected","when","spread","send","get","put","del","post","invoke","keys","apply","call","bind","fapply","fcall","fbind","all","allResolved","view","viewInfo","timeout","delay","catch","finally","fail","fin","progress","end","done","nfcall","nfapply","nfbind","ncall","napply","nbind","npost","ninvoke","nend","nodeify"],function(e,n){O.prototype[n]=function(){return t[n].apply(t,[this].concat(h(arguments)))}},void 0),O.prototype.toSource=function(){return this.toString()},O.prototype.toString=function(){return"[object Promise]"},s(O.prototype),t.nearer=M,t.isPromise=_,t.isPromiseAlike=D,t.isResolved=P,t.isFulfilled=H,t.isRejected=B;var j=[],F=[],I;t.reject=R,t.begin=U,t.resolve=U,t.ref=k(U,"ref","resolve"),t.master=z,t.viewInfo=W,t.view=X,t.when=V,t.spread=$,t.async=J,t["return"]=K,t.promised=Q,t.sender=k(G,"sender","dispatcher"),t.Method=k(G,"Method","dispatcher"),t.send=k(Y,"send","dispatch"),t.dispatch=Z,t.dispatcher=et,t.get=et("get"),t.put=et("put"),t["delete"]=t.del=et("del");var tt=t.post=et("post");t.invoke=function(e,t){var n=h(arguments,2);return tt(e,t,n)};var nt=t.apply=k(et("apply"),"apply","fapply"),rt=t.fapply=et("fapply");t.call=k(it,"call","fcall"),t["try"]=st,t.fcall=st,t.bind=k(ot,"bind","fbind"),t.fbind=ut,t.keys=et("keys"),t.all=at,t.allResolved=ft,t["catch"]=t.fail=lt,t.progress=ct,t["finally"]=t.fin=ht,t.end=k(pt,"end","done"),t.done=pt,t.timeout=dt,t.delay=vt,t.nfapply=mt,t.nfcall=gt,t.nfbind=yt,t.napply=k(bt,"napply","npost"),t.ncall=k(wt,"ncall","ninvoke"),t.nbind=k(Et,"nbind","nfbind"),t.npost=St,t.ninvoke=xt,t.nend=k(Tt,"nend","nodeify"),t.nodeify=Tt;var Nt=C()}),e.exports}({},{}),f=function(e,t){e.exports=t;var r=a,i=n,s=document.createDocumentFragment();return e.exports=function(e){var t=r.defer(),n=new Image;return n.src=e,n.onload=function(){s.appendChild(n),t.resolve(new i(n))},n.onerror=t.reject.bind(t),t.promise},e.exports}({},{}),l=function(e,t){e.exports=t;var n=a,r=f,i="http://api.flickr.com/services/feeds/photos_public.gne?format=json",s=0,o={};return window.FLICKR_CALLBACKS=o,e.exports=function(e){var t=n.defer(),u=document.createElement("script"),a="cb"+s++,f=i+"&jsoncallback=FLICKR_CALLBACKS."+a+"&tags="+e;return u.async=!0,u.src=f,o[a]=function(e){delete o[a];var i=[];e.items.forEach(function(e){i.push(r(e.media.m.replace("_m.jpg","_z.jpg")))}),n.all(i).done(t.resolve.bind(t))},document.body.appendChild(u),t.promise},e.exports}({},{}),c=function(e,t){function u(e){var t=n.defer(),r=e.videoId,s=e.width||1060,u=e.height||650,a="player"+o++,c=document.createElement("div");return c.width=s,c.height=u,c.innerHTML='<div id="'+a+'"></div><div class="video-mask"></div>',e.container.appendChild(c),new YT.Player(a,{height:u,width:s,playerVars:{controls:0,html5:1},videoId:r,events:{onReady:function(n){var r=n.target,s=new l(r,c),o=new i(f(s));e.loop&&(s.loop=!0),e.continuousPlay&&(o.continuousPlay=!0),e.mute&&(r.mute(),r.setVolume(0)),t.resolve(o),e.callback&&e.callback(o)},onError:function(e){t.reject(e)}}}),t.promise}function f(e){var t={};return t.player=e.player,t.element=e.element,t.on=e.emitter.on.bind(e.emitter),t.removeListener=e.emitter.removeListener.bind(e.emitter),t.kill=e.kill.bind(e),t}function l(e,t){this.id=e.id,this.player=e,this.element=t,this.lastReportedTime=0,this.emitter=new EventEmitter,e.addEventListener("onStateChange",this.onStatusChange.bind(this))}e.exports=t,s;var n=a,i=r;e.exports=function(e){if(e.videoId)return u(e);if(e.videoIds){var t=e.videoIds.length,r=[];while(t--)e.videoId=e.videoIds[t],r.push(u(e));return n.all(r)}};var o=0;return l.prototype.kill=function(){this.container.parentNode.removeChild(this.container),this.emitter.emit("dead")},l.prototype.onStatusChange=function(e){switch(e.data){case-1:this.emitter.emit("unstarted");break;case 0:this.emitter.emit("ended"),this.loop&&(this.player.seekTo(0),this.player.playVideo());break;case 1:this.emitter.emit("playing");break;case 2:this.emitter.emit("paused");break;case 3:this.emitter.emit("buffering");break;case 5:this.emitter.emit("video cued")}},e.exports}({},{}),h=function(e,t){e.exports=t;var r=a,s=n,o=i,u='<h2><a href="{{url}}">{{{title}}}</a></h2>{{#image}}<img class="article-image" src="{{image.src}}" width="{{image.width}}" height="{{image.height}}"/>{{/image}}<div class="article-attribution"><img class="nyt-brand" src="http://graphics8.nytimes.com/packages/images/developer/logos/poweredby_nytimes_30a.png"/><span class="byline">{{{byline}}}</span><span class="date">{{date}}</span></div><p>{{{body}}}</p>',f=document.createDocumentFragment();return e.exports=function(e){var t=this,n=document.createElement("div");console.log(e),n.className="nytimes-article";var i={title:e.title,byline:e.byline,date:(new Date(e.publication_year,e.publication_month,e.publication_day)).toLocaleDateString(),body:e.body,url:e.url};return e.small_image_url&&(i.image={src:e.small_image_url.replace(/thumbStandard.*\./,"hpMedium."),height:253,width:337}),n.innerHTML=o.render(u,i),document.body.appendChild(n),n.width=n.clientWidth,n.height=n.clientHeight,f.appendChild(n),r.resolve(new s(n))},e.exports}({},{}),p=function(e,t){return e.exports=t,t.flickr=l,t.image=f,t.youtube=c,t.nyTimes=h,e.exports}({},{}),d=function(e,t){function n(){this.elements=[]}return e.exports=t,e.exports=n,n.create=function(e){e=e||{};var t=new n;return"skipProbability"in e&&(t.skipProbability=e.skipProbability),"tryLimit"in e&&(t.tryLimit=e.tryLimit),t},n.prototype.chanceMultiplier=1,n.prototype.skipProbability=0,n.prototype.add=function(e){var t=e.chanceMultiplier;while(t--)this.elements.push(e)},n.prototype.remove=function(e){var t;while(~(t=this.elements.indexOf(e)))this.elements.splice(t,1)},n.prototype.getElements=function(){return this.elements.slice()},n.prototype.getRandomElement=function(){return this.elements[Math.random()*this.elements.length|0]},e.exports}({},{}),v=function(e,t){e.exports=t;var n=e.exports=function(e,t,n){this.element=e,this.top=n||0,this.left=t||0,this.width=this.element.width,this.height=this.element.height,this.bottom=this.top+this.height,this.right=this.left+this.width};return n.prototype.touches=function(e,t,n,r){},n.prototype.show=function(e){this.visible=!0,this.element.show(this.left,this.top,e)},n.prototype.hide=function(e){this.visible=!1,this.element.hide(e)},e.exports}({},{}),m=function(e,t){e.exports=t;var n=a,r=u.create,i=o,s=v,f=d,l=e.exports=function(e){i.call(this,e),this.quadtree=r(15e3),this.tags={},this.activeTags=[],this.updateCanvasDimensions(),window.c=this};return l.prototype=Object.create(i.prototype),l.create=function(e){var t=new l(e);return l.getApi(t)},l.getApi=function(e){var t=i.getApi(e);return t.createTag=e.createTag.bind(e),t.configureTag=e.configureTag.bind(e),t.setActiveTags=e.setActiveTags.bind(e),t.load=e.loadElements.bind(e),t.add=e.addElements.bind(e),t.remove=e.removeElement.bind(e),t.get=e.getElements.bind(e),t},l.prototype.loaders=p,l.prototype.scanTryLimit=200,l.prototype.missLimit=4,l.prototype.elementMargin=25,l.prototype.overScan=0,l.prototype.hidingArea=document.createDocumentFragment(),l.prototype.minElementSize=50,l.prototype.createTag=function(e,t){return this.tags[e]=f.create(t)},l.prototype.configureTag=function(e,t){var n=this.tags[e];if(!n){this.createTag(t);return}skipProbability in t&&(n.skipProbability=t.skipProbability),tryLimit in t&&(n.tryLimit=t.tryLimit)},l.prototype.loadElements=function(e,t,r){var i=this.addElements.bind(this,e),s,o,u,a,f,l,c,h=[];typeof t=="string"?s={arg2:r}:s=t;for(o in s)if(s.hasOwnProperty(o)){u=this.loaders[o],f=s[o],Array.isArray(f)||(f=[f]),l=f.length;while(a=f[--l])c=u(a).then(i),h.push(c)}return n.allResolved(h)},l.prototype.loadFlickrImages=function(e,t){return l.loader.flickr(e).then(this.add.bind(this))},l.prototype.addElements=function(e,t){Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]);var n=e.length,r,i,s=t.length;while(r=e[--n]){i=this.tags[r]||this.createTag(r);while(s--)i.add(t[s])}},l.prototype.removeElement=function(e,t){Array.isArray(e)||(e=[e]);var n=e.length,r,i;while(r=e[n--]){i=this.tags[r];if(!i)continue;i.remove(t)}},l.prototype.getElements=function(){var e=arguments.length>0?arguments:Object.keys(this.tags),t=e.length,n,r,i,s=[];while(n=e[--t])if(r=this.tags[n])s=s.concat(r.getElements());return s},l.prototype.setActiveTags=function(){var e=arguments.length,t,n,r,i=[];while(t=arguments[--e])if(n=this.tags[t]){r=n.chanceMultiplier;while(r--)i.push(n)}this.activeTags=i},l.prototype.getRandomActiveTag=function(){var e,t=this.getRandomActiveTagFailSafe;while(t--){e=this.activeTags[Math.random()*this.activeTags.length|0];if(e.skipProbability<Math.random())break}return e},l.prototype.getRandomActiveTagFailSafe=20,l.prototype.getRandomElementFailSafe=20,l.prototype.getRandomElementTryLimit=20,l.prototype.getRandomElement=function(){var e=this.getRandomElementFailSafe,t=!0,n=this.canvasLeft-this.canvasWidth,r=this.canvasTop-this.canvasHeight,i=this.canvasRight+this.canvasWidth,s=this.canvasBottom+this.canvasHeight,o,u,a;while(t&&e--){u=this.getRandomActiveTag(),a=u.tryLimit||this.getRandomElementTryLimit;while(a--){o=u.getRandomElement(),t=o.isIn(n,r,i,s);if(!t)break}}if(t){e=this.getRandomElementFailSafe;while(t&&e--){u=this.getRandomActiveTag(),a=u.tryLimit||this.getRandomElementTryLimit;while(t&&a--){o=u.getRandomElement(),t=o.isIn(this.canvasLeft,this.canvasTop,this.canvasRight,this.canvasBottom);if(!t)break}}}return o},l.prototype.step=function(){i.prototype.step.call(this),this.fill()},l.prototype.start=function(){arguments.length>0&&this.setActiveTags.apply(this,arguments);if(this.activeTags.length===0)throw new Error("Unable to start without active tags");i.prototype.start.call(this),this.updateCanvasDimensions(),this.pickNextElement(),this.fillCenter()},l.prototype.pickNextElement=function(){this.nextElement=this.getRandomElement(),this.missCount=0,this.updateScanDimensions()},l.prototype.insertNextElement=function(e,t,n){var r=new s(this.nextElement,e,t);this.nextElement.locations.push(r),this.quadtree.insert(r),n?r.show(this.element):r.hide(this.hidingArea),this.pickNextElement()},l.prototype.hideOutOfViewElements=function(e){var t=this.minElementSize,n=this.canvasLeft-this.horizontalSpeedLimit-1,r=this.canvasRight+this.horizontalSpeedLimit+t,i,s=this.canvasTop-this.verticalSpeedLimit-1,o=this.canvasBottom+this.verticalSpeedLimit+t,u,a;u=s;for(;u<=this.canvasTop;u+=t){i=n;for(;i<=r;i+=t)a=this.quadtree.hasObject(i,u,1,1),a&&(i=a.right,a.visible&&!~e.indexOf(a)&&a.hide(this.hidingArea))}u=this.canvasBottom;for(;u<=o;u+=t){i=n;for(;i<=r;i+=t)a=this.quadtree.hasObject(i,u,1,1),a&&(i=a.right,a.visible&&!~e.indexOf(a)&&a.hide(this.hidingArea))}i=n;for(;i<=this.canvasLeft;i+=t){u=this.canvasTop;for(;u<=this.canvasBottom;u+=t)a=this.quadtree.hasObject(i,u,1,1),a&&(u=a.bottom,a.visible&&!~e.indexOf(a)&&a.hide(this.hidingArea))}i=this.canvasRight;for(;i<=r;i+=t){u=this.canvasTop;for(;u<=this.canvasBottom;u+=t)a=this.quadtree.hasObject(i,u,1,1),a&&(u=a.bottom,a.visible&&!~e.indexOf(a)&&a.hide(this.hidingArea))}},l.prototype.showInViewElements=function(){var e=this.minElementSize,t=this.canvasLeft+this.horizontalSpeedLimit,n=this.canvasRight-this.horizontalSpeedLimit,r=this.canvasRight+e,i,s=this.canvasTop+this.verticalSpeedLimit,o=this.canvasBottom-this.verticalSpeedLimit,u=this.canvasBottom+e,a,f,l=[];a=this.canvasTop;for(;a<s;a+=e){i=this.canvasLeft;for(;i<r;i+=e)f=this.quadtree.hasObject(i,a,1,1),f&&(l.push(f),i=f.right,f.visible||f.show(this.element))}a=o;for(;a<u;a+=e){i=this.canvasLeft;for(;i<r;i+=e)f=this.quadtree.hasObject(i,a,1,1),f&&(l.push(f),i=f.right,f.visible||f.show(this.element))}i=this.canvasLeft;for(;i<t;i+=e){a=s;for(;a<o;a+=e)f=this.quadtree.hasObject(i,a,1,1),f&&(l.push(f),a=f.bottom,f.visible||f.show(this.element))}i=n;for(;i<r;i+=e){a=s;for(;a<o;a+=e)f=this.quadtree.hasObject(i,a,1,1),f&&(l.push(f),a=f.bottom,f.visible||f.show(this.element))}return l},l.prototype.updateElementVisibility=function(){var e=this.showInViewElements();this.hideOutOfViewElements(e)},l.prototype.updateScanDimensions=function(){this.checkWidth=this.nextElement.width+this.elementMargin*2,this.scanLeft=this.canvasLeft-this.checkWidth,this.scanWidth=this.canvasWidth+this.checkWidth*2,this.scanRangeX=this.shiftX,this.scanRight=this.scanLeft+this.scanWidth,this.checkHeight=this.nextElement.height+this.elementMargin*2,this.scanTop=this.canvasTop-this.checkWidth,this.scanHeight=this.canvasHeight+this.checkWidth*2,this.scanRangeY=this.shiftY,this.scanBottom=this.scanTop+this.scanHeight},l.prototype.updateCanvasDimensions=function(){this.shiftY=Math.abs(this.offsetY-(this.lastOffsetY||this.offsetY)),this.shiftX=Math.abs(this.offsetX-(this.lastOffsetX||this.offsetX)),this.canvasLeft=-1*this.offsetX-this.overScan,this.canvasTop=-1*this.offsetY-this.overScan,this.canvasWidth=this.width+this.overScan*2,this.canvasHeight=this.height+this.overScan*2,this.canvasRight=this.canvasLeft+this.canvasWidth,this.canvasBottom=this.canvasTop+this.canvasHeight},l.prototype.fillCenter=function(){this.updateCanvasDimensions(),this.updateScanDimensions();var e,t,n=0,r=this.scanTryLimit*500,i=0,s=r/100;for(;n<r;n++)e=this.scanLeft+this.scanWidth*Math.random()|0,t=this.scanTop+this.scanHeight*Math.random()|0,i++,i>s&&(i=0,this.pickNextElement()),this.quadtree.hasObject(e-this.elementMargin,t-this.elementMargin,this.checkWidth,this.checkHeight)||(i=0,this.insertNextElement(e,t,!0),this.nextElement||this.pickNextElement());this.updateElementVisibility()},l.prototype.fill=function(){this.updateCanvasDimensions(),this.updateScanDimensions(),this.updateElementVisibility();var e=0,t=this.scanTryLimit,n,r,i;this.missCount++,this.missCount>this.missLimit&&this.pickNextElement();for(;e<t;e++){this.offsetY<this.lastOffsetY?(r=this.scanLeft+this.scanWidth*Math.random()|0,i=this.canvasTop+this.canvasHeight+this.scanRangeY*Math.random()|0):(r=this.scanLeft+this.scanWidth*Math.random()-this.checkWidth|0,i=this.canvasTop-this.scanRangeY*Math.random()-this.checkHeight|0),n=this.quadtree.hasObject(r-this.elementMargin,i-this.elementMargin,this.checkWidth,this.checkHeight);if(!n){this.insertNextElement(r,i);if(!this.nextElement)return}this.offsetX<this.lastOffsetX?(r=this.canvasLeft+this.canvasWidth+this.scanRangeX*Math.random()|0,i=this.scanTop+this.scanHeight*Math.random()|0):(r=this.canvasLeft-this.scanRangeX*Math.random()-this.checkWidth|0,i=this.scanTop+this.scanHeight*Math.random()-this.checkHeight|0),n=this.quadtree.hasObject(r-this.elementMargin,i-this.elementMargin,this.checkWidth,this.checkHeight);if(!n){this.insertNextElement(r,i);if(!this.nextElement)return}}this.lastOffsetX=this.offsetX,this.lastOffsetY=this.offsetY},e.exports}({},{});return m}();